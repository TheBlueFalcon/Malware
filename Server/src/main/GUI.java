package main;

import java.awt.*; // Using AWT layouts
import java.awt.event.*; // Using AWT event classes and listener interfaces
import javax.swing.*; // Using Swing components and containers
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import remote.Connect;

public class GUI extends JFrame {

	static JLabel label;
	static JTabbedPane tabbedPane;
	static JPanel threadsPanel;
	static JPanel chatPanel;
	static JPanel panelThree;

	public GUI() {

		Container cp = getContentPane();

		GroupLayout layout = new GroupLayout(cp);
		cp.setLayout(layout);

		tabbedPane = new JTabbedPane();
		threadsPanel = initThreads();
		add(threadsPanel);
		chatPanel = initChat();
		add(chatPanel);
		panelThree = new JPanel();
		// threadsPanel.setLayout(null);

		tabbedPane.addTab("Connections", threadsPanel);

		tabbedPane.addTab("Chat", chatPanel);

		panelThree.setLayout(null);
		tabbedPane.addTab("tab3", panelThree);
		tabbedPane.addChangeListener(new ChangeListener() {

			@Override
			public void stateChanged(ChangeEvent e) {
				if (e.getSource() instanceof JTabbedPane) {
					JTabbedPane pane = (JTabbedPane) e.getSource();
					int panelNo = pane.getSelectedIndex();
					switch (panelNo) {
						case 0:
							updateThreads();
					}
				}
			}
		});

		layout.setHorizontalGroup(
				layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(tabbedPane));
		layout.setVerticalGroup(
				layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(tabbedPane));
		pack();

		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

		setTitle("Malware Server"); // "super" JFrame sets title
		/*
		 * setExtendedState(JFrame.MAXIMIZED_BOTH); setUndecorated(true);
		 * setVisible(true);
		 */
		setSize(750, 750); // "super" JFrame sets initial size
		setVisible(true); // "super" JFrame shows
	}

	public static void addThreads(String threadName) {
		JButton newButton = new JButton(threadName);
		threadsPanel.add(newButton);
		threadsPanel.revalidate();
		threadsPanel.repaint();
	}

	private JPanel initChat() {
		JPanel chatPanel = new JPanel();

		chatPanel.setLayout(new GridBagLayout());
		GridBagConstraints c = new GridBagConstraints();

		JButton refresh = new JButton("Start chat with localhost");
		refresh.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				Connect.activeConnections.get("127.0.0.1").chat();
				System.out.println("Button pressed");				
			}
		});

		c.fill = GridBagConstraints.HORIZONTAL;
		c.ipady = 40; // make this component tall
		c.weightx = 0.0;
		c.gridwidth = 3;
		c.gridx = 0;
		c.gridy = 0;
		chatPanel.add(refresh, c);

		return chatPanel;
	}

	private JPanel initThreads() {
		JPanel threadsPanel = new JPanel();

		threadsPanel.setLayout(new GridBagLayout());
		GridBagConstraints c = new GridBagConstraints();

		JButton refresh = new JButton("Refresh");
		refresh.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				updateThreads();				
			}
		});

		c.fill = GridBagConstraints.HORIZONTAL;
		c.ipady = 40; // make this component tall
		c.weightx = 0.0;
		c.gridwidth = 3;
		c.gridx = 0;
		c.gridy = 0;
		threadsPanel.add(refresh, c);

		return threadsPanel;
	}

	public void updateThreads() {
		Component[] components = threadsPanel.getComponents();
		for (Component jb : components) {

			System.out.println(((JButton)jb).getText());
			if ((jb.toString().indexOf("JButton") != -1) && ((JButton)jb).getText() != "Refresh") {
				threadsPanel.remove(jb);
			}
			
			
		}
		threadsPanel.revalidate();
		threadsPanel.repaint();
		try {
			Thread.sleep(1500); //add some lag to make it feel authentic
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		//initThreads();
		for (Thread t : Thread.getAllStackTraces().keySet()) {
			if (t.toString().indexOf(".") != -1) {
				addThreads(t.getName());
			}
		}
	}
}

class ThreadsPanel extends JPanel {

	int i = 0;

	public ThreadsPanel() {
		System.out.println("TEST TEST TEST");
	}

	
}